<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Paste BhavCopy CSV → Save to data/raw</title>
  <style>
    body { font-family: Arial; background: #f4f6f9; padding: 20px; }
    textarea { width: 100%; height: 300px; font-family: monospace; font-size: 14px; }
    .box { background: white; padding: 20px; border-radius: 12px; max-width: 900px; margin:auto; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    button { padding: 10px 18px; font-size: 16px; border-radius: 8px; border: none; background: #007bff; color: white; cursor: pointer; }
    button:hover { background: #0056c7; }
    #status { margin-top: 15px; font-weight: bold; }
  </style>
</head>
<body>
  <div class="box">
    <h2>Paste BhavCopy CSV Text</h2>
    <p>Paste the FULL CSV content here (after extracting ZIP). This tool will automatically create a file inside <code>data/raw/</code> using GitHub API.</p>

    <textarea id="csvText" placeholder="Paste CSV content here..."></textarea>
    <br><br>

    <label>Filename:</label>
    <input id="fileName" type="text" value="BhavCopy_pasted.csv" style="padding:8px; width:60%; margin-left:10px;">
    <br><br>

    <button onclick="uploadCSV()">Upload to data/raw</button>

    <div id="status"></div>
  </div>

<script>
async function uploadCSV() {
  const csv = document.getElementById('csvText').value.trim();
  const name = document.getElementById('fileName').value.trim();
  const status = document.getElementById('status');

  if (!csv) {
    status.innerText = '❌ CSV text is empty!';
    return;
  }
  if (!name) {
    status.innerText = '❌ Filename cannot be empty!';
    return;
  }

  status.innerText = '⏳ Uploading...';

  // ---- CONFIG (EDIT YOUR REPO DETAILS BELOW) ----
  const USER = "ushalbansode-ai";
  const REPO = "nse-option-signals";
  const BRANCH = "main";

  // Ask user for GitHub token
  const token = prompt("Enter your GitHub Personal Access Token (PAT):\nRequired for uploading files.");
  if (!token) {
    status.innerText = '❌ Upload cancelled (no token entered).';
    return;
  }

  const apiUrl = `https://api.github.com/repos/${USER}/${REPO}/contents/data/raw/${name}`;

  const fileData = btoa(unescape(encodeURIComponent(csv)));

  const payload = {
    message: `Add CSV via browser uploader (${name})`,
    content: fileData,
    branch: BRANCH
  };

  const res = await fetch(apiUrl, {
    method: 'PUT',
    headers: {
      'Authorization': `token ${token}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(payload)
  });

  if (res.status === 201 || res.status === 200) {
    status.innerHTML = `✅ Uploaded successfully!<br>File: data/raw/${name}`;
  } else {
    const err = await res.json();
    status.innerText = `❌ Error: ${err.message}`;
  }
}
</script>
</body>
</html>
